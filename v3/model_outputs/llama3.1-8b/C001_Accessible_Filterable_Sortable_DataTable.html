<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Data Table</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
</head>
<body>
    <div class="container mx-auto p-4">
        <table class="w-full border-collapse border border-gray-400 data-testid='user-data-table'">
            <caption class="bg-gray-200 p-2 text-lg font-bold" data-testid="table-caption">User Information</caption>
            <thead class="bg-gray-200 text-lg">
                <tr>
                    <th class="px-4 py-2 cursor-pointer text-gray-800 data-testid='sort-by-Name' onclick="sortTable('Name', 'name')">Name</th>
                    <th class="px-4 py-2 cursor-pointer text-gray-800 data-testid='sort-by-Age' onclick="sortTable('Age', 'age')">Age</th>
                </tr>
            </thead>
            <tbody class="border-b-4 border-gray-400" data-testid="table-body">
                <tr>
                    <td class="px-4 py-2 hover:bg-gray-100">John Doe</td>
                    <td class="px-4 py-2 hover:bg-gray-100">25</td>
                </tr>
                <tr>
                    <td class="px-4 py-2 hover:bg-gray-100">Jane Doe</td>
                    <td class="px-4 py-2 hover:bg-gray-100">30</td>
                </tr>
                <tr>
                    <td class="px-4 py-2 hover:bg-gray-100">Bob Smith</td>
                    <td class="px-4 py-2 hover:bg-gray-100">28</td>
                </tr>
                <tr>
                    <td class="px-4 py-2 hover:bg-gray-100">Alice Johnson</td>
                    <td class="px-4 py-2 hover:bg-gray-100">35</td>
                </tr>
                <tr>
                    <td class="px-4 py-2 hover:bg-gray-100">Mike Davis</td>
                    <td class="px-4 py-2 hover:bg-gray-100">22</td>
                </tr>
            </tbody>
        </table>
        <input type="search" class="border border-gray-400 p-2 ml-4" data-testid="user-table-filter" placeholder="Search users by name or email" oninput="filterTable(this)">
    </div>

    <script>
        let sortColumn = 'name';
        let sortDirection = 'asc';

        function sortTable(columnName, sortColumnCurrent) {
            if (columnName === sortColumn) {
                if (sortDirection === 'asc') {
                    sortDirection = 'desc';
                } else {
                    sortDirection = 'asc';
                }
            } else {
                sortColumn = columnName;
                sortDirection = 'asc';
            }

            let tbody = document.getElementById('table-body');
            let rows = Array.from(tbody.children).sort((a, b) => {
                if (columnName === "Name") {
                    if (sortDirection === 'asc') {
                        return a.cells[0].textContent.localeCompare(b.cells[0].textContent);
                    } else {
                        return b.cells[0].textContent.localeCompare(a.cells[0].textContent);
                    }
                } else if (columnName === "Age") {
                    return parseInt(a.cells[1].textContent) - parseInt(b.cells[1].textContent);
                }
            });

            tbody.innerHTML = '';
            rows.forEach(row => tbody.appendChild(row));
        }

        let filterTimeout;

        function filterTable(input) {
            clearTimeout(filterTimeout);
            filterTimeout = setTimeout(() => {
                let filterValue = input.value.toLowerCase();
                let tableRows = Array.from(document.querySelectorAll('.table-row'));
                tableRows.forEach(row => {
                    let name = row.cells[0].textContent.toLowerCase();
                    let email = row.cells[1].textContent.toLowerCase();
                    if (!(name.includes(filterValue) || email.includes(filterValue))) {
                        row.classList.remove('visible');
                    } else {
                        row.classList.add('visible');
                    }
                });
            }, 500);
        }
    </script>
    <style>
        /* To make the table rows visible and invisible */
        .table-row {
            opacity: 0;
        }

        .visible {
            opacity: 1;
        }

        /* Make sure the columns are sorted by clicking on the headers */
        .sortable th:hover {
            cursor: pointer;
        }

        /* Add aria-sort attribute to the sorted columns */
        .sort-by-Name:after {
            content: '\2193';
        }

        .sort-by-Name.sort-asc.more-specific {
            content: '\2191';
        }

        .sort-by-Age:after {
            content: '\2193';
        }

        .sort-by-Age.sort-asc.more-specific {
            content: '\2191';
        }

        /* To trigger sorting of table columns, override the default align */
        th.sortable td {
            white-space: nowrap;
        }
    </style>
</body>
</html>
